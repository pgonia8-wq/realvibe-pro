<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RealVibe Pro</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body{
  font-family:'Plus Jakarta Sans',sans-serif;
  background: linear-gradient(180deg,#f8f9fa 0%,#ffffff 100%);
  margin:0;
  padding:0;
  overflow-x:hidden;
}
#discoverSection{
  display:flex;
  justify-content:center;
  align-items:center;
  height:90vh;
  position:relative;
}
.card{
  width:90%;
  max-width:400px;
  height:500px;
  background:white;
  border-radius:2xl;
  box-shadow:0 12px 30px rgba(0,0,0,0.15);
  overflow:hidden;
  position:absolute;
  top:0;
  transition:transform 0.3s, opacity 0.3s;
}
.card img{
  width:100%;
  height:100%;
  object-fit:cover;
}
.overlay{
  position:absolute;
  bottom:0;
  width:100%;
  background:linear-gradient(transparent, rgba(0,0,0,0.6));
  color:white;
  padding:16px;
}
.overlay h2{
  font-size:1.5rem;
  font-weight:700;
}
.overlay p{
  font-size:0.9rem;
  margin-top:4px;
}
.buttons{
  position:fixed;
  bottom:20px;
  width:100%;
  display:flex;
  justify-content:center;
  gap:12px;
  z-index:50;
}
.buttons button{
  padding:14px 24px;
  border-radius:16px;
  font-weight:700;
  color:white;
  font-size:0.95rem;
  min-width:90px;
  box-shadow:0 6px 12px rgba(0,0,0,0.15);
}
.like{background:linear-gradient(90deg,#ff69b4,#8a2be2);}
.dislike{background:linear-gradient(90deg,#a3a3a3,#6b6b6b);}
.superlike{background:linear-gradient(90deg,#00bfff,#1e90ff);}
</style>
</head>
<body>

<div id="discoverSection"></div>

<div class="buttons">
  <button class="dislike" id="btnDislike">Dislike</button>
  <button class="superlike" id="btnSuperLike">Super Like</button>
  <button class="like" id="btnLike">Like</button>
</div>

<script>
const SUPABASE_URL="https://bogcdpwnnjxfgfdcewif.supabase.co";
const SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJvZ2NkcHdubmp4ZmdmZGNld2lmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyOTM2MjgsImV4cCI6MjA4Njg2OTYyOH0.65pFiqgEmjogf73mZCG-yT2BZqx6Q8cbA_Ce9RhnIhQ";

const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let profiles = [];
let currentIndex = 0;
let currentUser = "user_1"; // asegúrate que tu propio ID esté en minúscula
const discoverSection = document.getElementById("discoverSection");

// --- CARGAR PERFILES ---
async function loadProfiles(){
  try{
    const { data, error } = await supabase
      .from("profiles")
      .select("*")
      .neq("id", currentUser)   // No mostrar tu propio perfil
      .eq("invisible", false)   // Solo visibles
      .limit(10);

    if(error) console.log("Error Supabase:", error);

    profiles = (data && data.length>0) ? data : [
      {id:"user_2", name:"Ana", bio:"Me gusta la música", photo_url:"https://picsum.photos/400/500?2"},
      {id:"user_3", name:"Luis", bio:"Aventurero", photo_url:"https://picsum.photos/400/500?3"},
      {id:"user_4", name:"Marta", bio:"Amante del café", photo_url:"https://picsum.photos/400/500?4"}
    ];

    currentIndex=0;
    console.log("Perfiles cargados:", profiles);
    renderCards();
  }catch(e){
    console.log("Error general:", e);
    // perfiles de prueba si falla Supabase
    profiles = [
      {id:"user_2", name:"Ana", bio:"Me gusta la música", photo_url:"https://picsum.photos/400/500?2"},
      {id:"user_3", name:"Luis", bio:"Aventurero", photo_url:"https://picsum.photos/400/500?3"},
      {id:"user_4", name:"Marta", bio:"Amante del café", photo_url:"https://picsum.photos/400/500?4"}
    ];
    renderCards();
  }
}

// --- RENDERIZAR TARJETAS ---
function renderCards(){
  discoverSection.innerHTML="";
  profiles.slice().reverse().forEach((profile,i)=>{
    const card = document.createElement("div");
    card.className="card";
    card.dataset.index=i;
    card.innerHTML = `
      <img src="${profile.photo_url}" alt="Profile">
      <div class="overlay">
        <h2>${profile.name}</h2>
        <p>${profile.bio}</p>
      </div>
    `;
    card.style.zIndex=i;
    discoverSection.appendChild(card);
    if(i===profiles.length-1) addSwipe(card);
  });
}

// --- SWIPE TARJETA SUPERIOR ---
function addSwipe(card){
  let startX=0,currentX=0,isDragging=false;
  card.addEventListener("touchstart",(e)=>{ startX=e.touches[0].clientX; isDragging=true; });
  card.addEventListener("touchmove",(e)=>{
    if(!isDragging) return;
    currentX = e.touches[0].clientX - startX;
    card.style.transform=`translateX(${currentX}px) rotate(${currentX/15}deg)`;
  });
  card.addEventListener("touchend",()=>{
    isDragging=false;
    if(currentX>80){ likeProfile(); swipeOut(card,"right"); }
    else if(currentX<-80){ dislikeProfile(); swipeOut(card,"left"); }
    else{ card.style.transition="transform 0.3s"; card.style.transform="translateX(0) rotate(0)"; setTimeout(()=>{card.style.transition="";},300); }
  });
}

// --- ANIMACIÓN TARJETA SALIDA ---
function swipeOut(card,dir){
  card.style.transition="transform 0.5s, opacity 0.5s";
  card.style.transform = `translateX(${dir==="right"?1000:dir==="left"?-1000:0}px) rotate(${dir==="right"?45:dir==="left"?-45:0}deg) translateY(${dir==="up"?-500:0}px)`;
  card.style.opacity=0;
  setTimeout(()=>{
    card.remove();
    currentIndex++;
    const next=document.querySelector(`.card[data-index='${profiles.length-1-currentIndex}']`);
    if(next) addSwipe(next);
  },500);
}

// --- LIKE / DISLIKE ---
async function likeProfile(){
  if(currentIndex>=profiles.length) return;
  const profile=profiles[currentIndex];
  console.log("Like a",profile.name);
  await supabase.from("likes").insert({user_id:currentUser,liked_user_id:profile.id});
}
function dislikeProfile(){
  if(currentIndex>=profiles.length) return;
  const profile=profiles[currentIndex];
  console.log("Dislike a",profile.name);
}

// --- BOTONES ---
document.getElementById("btnLike").addEventListener("click",()=>{
  const card=document.querySelector(".card:last-child");
  if(card){ likeProfile(); swipeOut(card,"right"); }
});
document.getElementById("btnDislike").addEventListener("click",()=>{
  const card=document.querySelector(".card:last-child");
  if(card){ dislikeProfile(); swipeOut(card,"left"); }
});
document.getElementById("btnSuperLike").addEventListener("click",()=>{
  const card=document.querySelector(".card:last-child");
  if(card){ console.log("Super Like a",profiles[currentIndex]?.name); swipeOut(card,"up"); currentIndex++; }
});

// --- INICIAR APP ---
window.addEventListener("load", loadProfiles);
</script>
</body>
</html>
